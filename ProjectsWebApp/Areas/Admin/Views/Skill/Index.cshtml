@model IEnumerable<Skill>

@{
    ViewData["Title"] = "Skills Verwaltung";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    /* Skills Admin Styles - Reusing Event Styles */
    .skills-admin-container {
        padding: 2rem 1rem;
        width: 100%;
        margin: 0;
    }

    .skills-table {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        border: none;
    }

        .skills-table thead {
            background: linear-gradient(135deg, #90bc14 0%, #76a614 100%);
            color: white;
        }

        .skills-table th {
            border: none !important;
            padding: 1.2rem 1.5rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .skills-table td {
            padding: 1rem 1.5rem;
            vertical-align: middle;
            border-color: #f3f4f6;
        }

        .skills-table tr:nth-child(even) {
            background-color: #f8fafc;
        }

        .skills-table tr:hover {
            background-color: #f1f5f9;
        }

    .action-buttons {
        display: flex;
        gap: 0.8rem;
        flex-wrap: wrap;
    }

    .btn-skill-action {
        padding: 0.5rem 1.2rem;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-edit {
        background: #fff3d6;
        border: 1px solid #ffe6b3;
        color: #d97706;
    }

        .btn-edit:hover {
            background: #ffecc7;
            color: #b45309;
        }

    .btn-delete {
        background: #fee2e2;
        border: 1px solid #fecaca;
        color: #dc2626;
    }

        .btn-delete:hover {
            background: #fecaca;
            color: #b91c1c;
        }

    .btn-add-skill {
        padding: 0.8rem 1.5rem;
        border-radius: 10px;
        font-weight: 600;
        transition: transform 0.2s ease;
        background: linear-gradient(135deg, #90bc14 0%, #76a614 100%);
        border: none;
    }

        .btn-add-skill:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(144, 188, 20, 0.3);
        }

    .description {
        max-width: 300px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }


    @@media (max-width: 768px) {
        .skills-table td:nth-child(3) {
            min-width: 180px;
        }

        .btn-skill-action {
            padding: 0.4rem 1rem;
            font-size: 0.9rem;
        }
    }
</style>

<div class="skills-admin-container">
    <h2 class="mb-4 display-5 fw-bold" style="color:#90bc14">Skills Verwaltung</h2>

    <div class="d-flex justify-content-end mb-4">
        <a asp-action="Upsert" class="btn btn-add-skill text-white">
            <i class="bi bi-plus-circle"></i> Neue Skill
        </a>
    </div>

    <table class="table skills-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Titel</th>
                <th>Beschreibung</th>
                <th>Aktionen</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var skill in Model.OrderBy(s => s.DisplayOrder))
            {
                <tr>
                    <td>@skill.DisplayOrder</td>
                    <td>@skill.Title</td>
                    <td class="description">@skill.Description</td>
                    <td>
                        <div class="action-buttons">
                            <a asp-action="Upsert" asp-route-id="@skill.Id" class="btn btn-skill-action btn-edit">
                                <i class="bi bi-pencil-square"></i> Bearbeiten
                            </a>
                            <button type="button" class="btn btn-skill-action btn-delete delete-btn" data-id="@skill.Id">
                                <i class="bi bi-trash3"></i> Löschen
                            </button>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
        document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', function () {
                const id = this.dataset.id;
                if (confirm("Möchten Sie diesen Skill wirklich löschen?")) {
                    fetch('@Url.Action("Delete")', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id: id })
                    }).then(r => r.json())
                        .then(data => {
                            if (data.success) location.reload();
                            else alert(data.message);
                        });
                }
            });
        });

        document.querySelectorAll('.description').forEach(function (element) {
            let sanitizedText = element.innerHTML
                // Remove HTML tags
                .replace(/<\/?p>/gi, '') // <p> tags
                .replace(/<\/?b>/gi, '') // <b> tags
                .replace(/<\/?strong>/gi, '') // <strong> tags
                .replace(/<\/?br>/gi, '') // <br> tags
                .replace(/<\/?ul>/gi, '') // <ul> tags
                .replace(/<\/?ol>/gi, '') // <ol> tags
                .replace(/<\/?li>/gi, '') // <li> tags
                .replace(/<\/?blockquote>/gi, '') // <blockquote> tags

                // Handle encoded entities for HTML tags
                .replace(/&lt;p&gt;/gi, ' ') // Encoded <p> tags
                .replace(/&lt;\/p&gt;/gi, ' ') // Encoded </p> tags
                .replace(/&lt;ul&gt;/gi, ' ') // Encoded <ul> tags
                .replace(/&lt;\/ul&gt;/gi, ' ') // Encoded </ul> tags
                .replace(/&lt;ol&gt;/gi, ' ') // Encoded <ol> tags
                .replace(/&lt;\/ol&gt;/gi, ' ') // Encoded </ol> tags
                .replace(/&lt;li&gt;/gi, ' ') // Encoded <li> tags
                .replace(/&lt;\/li&gt;/gi, ' ') // Encoded </li> tags
                .replace(/&lt;blockquote&gt;/gi, ' ') // Encoded <blockquote> tags
                .replace(/&lt;\/blockquote&gt;/gi, ' ') // Encoded </blockquote> tags
                .replace(/&lt;strong&gt;/gi, ' ') // Encoded <strong> tags
                .replace(/&lt;\/strong&gt;/gi, ' ') // Encoded </strong> tags
                .replace(/&lt;br\/&gt;/gi, ' ') // Encoded <br> tags

                // Remove additional non-breaking spaces or special characters
                .replace(/&nbsp;/gi, ' ') // Non-breaking spaces
                .replace(/&lt;/gi, '<') // Encoded <
                .replace(/&gt;/gi, '>') // Encoded >

                // Remove any remaining encoded tags (safety net)
                .replace(/<\/?[a-z][a-z0-9]*[^<>]*>/gi, ''); // Matches any HTML-like tags

            console.log(sanitizedText)
            // Update the sanitized text back into the element
            element.innerHTML = sanitizedText.trim();
        });


    </script>
}
